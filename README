MICRON INFORMATION
==================

Repo location:
    https://stash.micron.com/stash/scm/nve_tsw/dnvme.git

This is a fork of the following repo:
    https://github.com/nvmecompliance/dnvme
    
Contacts
--------
Chad Patel
Adam Mateen
Michael Schoberg
Robert Randall
    
Main Changes from Upstream
--------------------------
    - Add PCI B.D.F. in metrics_device->public_dev. So that it is available to user through IOCTL_GET_DEVICE_METRICS. (change for AMP)
    - Fix memory leak and memory corruption issue in dnvme when a device is removed and then re-probed (using unbind and bind).
    - Port fix from NVMEX project. Fixes incrementing in driver_generic_write().
    - Convert to DKMS build that produces a deb package, the old makefile only build is now intentionally broken.  You can use Makefile.dev if you need to use the original makefile for development.
    
Installation Instructions [Trusty/14.04 only]
---------------------------------------------
    - add the following line to /etc/apt/sources.list
        deb http://10.113.22.79 trusty/
    - sudo apt-get update
    - sudo apt-get install dnvme-dkms
    - The package can be removed at any time with apt-get remove dnvme-dkms
    
DKMS Build Steps 
----------------
    [NOTE: Trusty/14.04 only]
    [NOTE: Non-dkms build is intentionally broken!]

    - sudo apt-get install debhelper dkms
    - checkout the repo into a clean directory
    - increment the minor version number in version.h, keep note of the new version #
    - update debian\changelog file with change messages and release notes
      where {MAJOR} and {MINOR} are the new version you would like to use
        - dch -v {MAJOR}.{MINOR}-1
    - create an orig tar.gz file with all of the contents of the dnvme directory excluding debian
        e.g.: dnvme_{MAJOR}.{MINOR}.orig.tar.gz
    - place the orig tar.gz in the parent directory to dnvme
    - run 'dpkg-buildpackage' in the dnvme directory
    - This should yield the following outputs in the parent directory:
        dnvme_{MAJOR}.{MINOR}-1_amd64.changes
        dnvme_{MAJOR}.{MINOR}-1.debian.tar.gz
        dnvme_{MAJOR}.{MINOR}-1.dsc
        dnvme_{MAJOR}.{MINOR}.orig.tar.gz
        dnvme-dkms_{MAJOR}.{MINOR}-1_all.deb
    - Copy these over to a staging area on wdlabfs1 in a folder named 'dnvme_3.2-1'
    - On the package server (currently named 'wdlapppa' on the lab network)
        - locate the packages and use the command 'sudo dput local dnvme_{MAJOR}.{MINOR}-1_amd64.changes' to get them added to the package server
        - verify the packages are in ~/archive/trusty
    - assuming everything was successfull, commit and push your changes to git
        
